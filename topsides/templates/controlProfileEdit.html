<html>
    <head>
        <link href="static/css/main.css" rel="stylesheet" type="text/css"/>
        <link href="static/css/controlProfileEdit.css" rel="stylesheet" type="text/css"/>
        
        <script src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}" type="text/javascript"></script>
        <script src="{{url_for('static', filename='js/EER2019.js')}}" type="text/javascript"></script>
        <script src="{{url_for('static', filename='js/ControlOptions.js')}}" type="text/javascript"></script>
        <script src="{{url_for('static', filename='js/joystickHandle.js')}}" type="text/javascript"></script>
        <script src="{{url_for('static', filename='js/ProfileHandle.js')}}" type="text/javascript"></script>
        <script>
            var profileToEdit = null;
            var PROFILEHANDLE;
            var CONTROLOPTIONS;
            runPythonGET("getProfiles", null, function(data){
                PROFILEHANDLE = new ProfileHandle(data);
            });

            runPythonGET("getControlOptions", null, function(data){
                CONTROLOPTIONS = new ControlOptions(data);
            });

            

            /**
             * Edit Modal fill logic
             * - input elements have a class of control-edit-input and an attribute "input-id"
             *      - input-id determines what feild from the json will fill that spot
             *      - EX: for input-id="name", the name of the profile will fill that
             * - when a profile is saved the values of the input-id in the json will be set the the value of that input
             * 
            */
            
            function editProfile_click(id){ //sets all the fields in the edit panel to the current values of that profile in the json and opens the panel
                var profile = PROFILEHANDLE.getProfileById(id);

                $.each($(".control-edit-input"), function(i, element){
                    let feild = $(element).attr("input-id");
                    let val = profile[feild];

                    element.value = val;
                });

                $.each(profile["gamepads"], function(i, gamepad){
                    console.log(gamepad);
                    let gamepadSelectorString = "<div class='selector' id='gamepadSelector" + i + "' onclick='openGamepadPanel_click(" + i + ")'>" + gamepad['name'] + "</div>";
                    let gamepadEditPanelString = "<div>";

                    $.each(gamepad["axes"], function(i2, axes){
                        gamepadEditPanelString += "<input class='joystick-axis-input' input-id='" + i2 + "' />"
                    });

                    $.each(gamepad["buttons"], function(i2, button){

                    });

                    gamepadEditPanelString += "</div>"

                    $("#joystick-selector-container").append(gamepadSelectorString);
                    $("#current-joystick-container").append(gamepadEditPanelString);
                });
            }

            function openGamepadMenu(){

            }

            function clearProfileEdit(){
                $(".control-edit-input")
            }

            function newProfile_click(id){
                clearProfileEdit();
            }
        </script>
    </head>
    <body>

        <div id="panelSelectProfile">
            <div class="profile-select-container">
                <h1>SELECT PROFILE</h1>
                {% for profile in profiles %}
                    <div class="profile-panel">
                        <p>{{profile["name"]}}</p>
                        <button class="btn btn-primary modal-trigger" modal-id="modalEditProfile" onclick="editProfile_click({{profile['id']}})">EDIT</button>
                        <button class="btn btn-danger modal-trigger" modal-id="modalEditProfile" onclick="deleteProfile({{profile['id']}})">DELETE</button>
                    </div>
                {% endfor %}
                <div class="profile-panel">
                    <p>New Profile</p>
                    <button class="btn btn-primary modal-trigger" modal-id="modalEditProfile" onclick="newProfile_click();">NEW</button>
                </div>
            </div>
        </div>
        <div id="modalEditProfile" class="modal">
            <div class="modal-content"> 
                <div class="header">
                    <input class="input-text control-edit-input" input-id="name" style="clear: both; display: block;" type="text" placeholder="Name" />
                </div>
                <div id="joystick-selector-container">
                    <!-- Placeholder for joystick selectors to go -->

                </div>
                <div id="current-joystick-container">

                </div>
            </div>
        </div>

    </body>
</html>